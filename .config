# 基础架构配置 (N5105 + x86_64 + ESXi)
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_Generic=y

# 固件格式 (适配ESXi虚拟化，支持VMDK/UEFI/BIOS)
CONFIG_GRUB_IMAGES=y
CONFIG_GRUB_EFI_IMAGES=y
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_EXT4FS=y
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_TARGET_ROOTFS_TARGZ=y
CONFIG_VMDK_IMAGES=y
# 扩容分区适配ESXi
CONFIG_TARGET_KERNEL_PARTSIZE=128
CONFIG_TARGET_ROOTFS_PARTSIZE=896

# 内核核心优化 (N5105 + ESXi + 网络性能)
CONFIG_KERNEL_BUILD_USER="OpenWRT-Build"
CONFIG_KERNEL_BUILD_DOMAIN="github.com"
CONFIG_KERNEL_IPV6=y
CONFIG_KERNEL_CGROUP_NET_PRIO=y
CONFIG_KERNEL_CGROUP_BPF=y
CONFIG_KERNEL_CPU_FREQ_GOV_ONDEMAND=y
CONFIG_KERNEL_INTEL_IDLE=y          # 建议开启节能
CONFIG_KERNEL_X86_INTEL_PSTATE=y
CONFIG_KERNEL_HPET_TIMER=y
CONFIG_KERNEL_NO_HZ_FULL=y
CONFIG_KERNEL_PREEMPT_VOLUNTARY=y   # 平衡响应性
CONFIG_KERNEL_NET_SCH_FQ_CODEL=y
CONFIG_KERNEL_NET_SCH_SFQ=y
CONFIG_KERNEL_NET_CLS_ACT=y
CONFIG_KERNEL_NET_ACT_MIRRED=y
CONFIG_KERNEL_TCP_CONG_BBR=y
CONFIG_KERNEL_TCP_FASTOPEN=y
CONFIG_KERNEL_IRQ_FORCED_THREADING=y
CONFIG_KERNEL_SMP=y

# 基础系统组件
CONFIG_PACKAGE_base-files=y
CONFIG_PACKAGE_bash=y
CONFIG_PACKAGE_coreutils=y
CONFIG_PACKAGE_coreutils-nohup=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_wget=y
CONFIG_PACKAGE_unzip=y
CONFIG_PACKAGE_zip=y
CONFIG_PACKAGE_tar=y
CONFIG_PACKAGE_gzip=y
CONFIG_PACKAGE_bzip2=y
CONFIG_PACKAGE_7z=y
CONFIG_PACKAGE_vim-full=y
CONFIG_PACKAGE_tree=y
CONFIG_PACKAGE_procps-ng=y
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_ethtool=y
CONFIG_PACKAGE_lm-sensors=y
CONFIG_PACKAGE_open-vm-tools=y
CONFIG_PACKAGE_pciutils=y
CONFIG_PACKAGE_usbutils=y

# 网络基础组件
CONFIG_PACKAGE_dnsmasq-full=y
CONFIG_PACKAGE_dnsmasq_full_dhcpv6=y
CONFIG_PACKAGE_dnsmasq_full_auth=y
CONFIG_PACKAGE_ip6tables=y
CONFIG_PACKAGE_iptables-mod-tproxy=y
CONFIG_PACKAGE_iptables-mod-extra=y
CONFIG_PACKAGE_ipset=y
CONFIG_PACKAGE_iproute2=y
CONFIG_PACKAGE_tcpdump=y
CONFIG_PACKAGE_ss=y
CONFIG_PACKAGE_nftables=y
CONFIG_PACKAGE_odhcp6c=y
CONFIG_PACKAGE_odhcpd-ipv6only=y
CONFIG_PACKAGE_ppp=y
CONFIG_PACKAGE_ppp-mod-pppoe=y
CONFIG_PACKAGE_wireless-tools=y
CONFIG_PACKAGE_wpa-supplicant=y
CONFIG_PACKAGE_irqbalance=y
CONFIG_PACKAGE_nload=y
CONFIG_PACKAGE_iftop=y

# ===== 替换 uhttpd → nginx 方案 START =====
# 移除 uhttpd 及其依赖
CONFIG_PACKAGE_uhttpd=n
CONFIG_PACKAGE_uhttpd-mod-ubus=n
CONFIG_PACKAGE_libustream-openssl=n
CONFIG_PACKAGE_libustream-mbedtls=n

# 启用 nginx + fcgi 支持 LuCI
CONFIG_PACKAGE_nginx=y
CONFIG_PACKAGE_nginx-mod-luci=y          # 关键：LuCI 的 nginx 配置模板
CONFIG_PACKAGE_fcgiwrap=y                # FastCGI 包装器，用于运行 CGI 脚本
CONFIG_PACKAGE_px5g=y                    # 用于生成自签名证书（可选 HTTPS）
# ===== 替换 uhttpd → nginx 方案 END =====

# Web 管理界面 (LuCI) - 保留核心，适配 nginx
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-compat=y
CONFIG_PACKAGE_luci-lib-ip=y
CONFIG_PACKAGE_luci-lib-jsonc=y
CONFIG_PACKAGE_luci-lib-nixio=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-theme-bootstrap=y    # 可选，体积小
CONFIG_PACKAGE_luci-app-argon-config=n

# OpenClash 专属优化
CONFIG_PACKAGE_luci-app-openclash=y
CONFIG_PACKAGE_luci-i18n-openclash-zh-cn=y
CONFIG_PACKAGE_openclash=y
CONFIG_PACKAGE_clash=y
CONFIG_PACKAGE_glib2=y
CONFIG_PACKAGE_libcap=y
CONFIG_PACKAGE_libcap-bin=y
CONFIG_PACKAGE_libyaml=y
CONFIG_PACKAGE_rclone=y
CONFIG_PACKAGE_kmod-tun=y
CONFIG_PACKAGE_kmod-nf-nat-tproxy=y
CONFIG_PACKAGE_iproute2-tc=y

# 常用网络插件
CONFIG_PACKAGE_luci-app-accesscontrol=y
CONFIG_PACKAGE_luci-app-ddns=y
CONFIG_PACKAGE_luci-app-diskman=y
CONFIG_PACKAGE_luci-app-firewall=y
CONFIG_PACKAGE_luci-app-ipsec-vpnd=y
CONFIG_PACKAGE_luci-app-nlbwmon=y
CONFIG_PACKAGE_luci-app-onliner=y
CONFIG_PACKAGE_luci-app-poweroff=y
CONFIG_PACKAGE_luci-app-samba4=y
CONFIG_PACKAGE_luci-app-wol=y

# 关闭无用插件（保持原样）
# CONFIG_PACKAGE_luci-app-autoreboot is not set
# ...（其余已关闭插件保持不变）...

# 存储相关 (ESXi PVSCSI)
CONFIG_PACKAGE_block-mount=y
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-ntfs=y
CONFIG_PACKAGE_kmod-fs-exfat=y
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-usb-storage-uas=y
CONFIG_PACKAGE_kmod-usb-ohci=y
CONFIG_PACKAGE_kmod-usb-uhci=y
CONFIG_PACKAGE_kmod-usb2=y
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_kmod-scsi-vmw-pvscsi=y

# 性能优化
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_zram-swap=y
CONFIG_PACKAGE_zram-tools=y
CONFIG_PACKAGE_swapspace=n               # zram 环境下通常不需要

# 移除无线驱动（ESXi 虚拟化无需）
CONFIG_PACKAGE_kmod-ath9k=n
CONFIG_PACKAGE_kmod-ath10k=n
CONFIG_PACKAGE_kmod-mt7601u=n
CONFIG_PACKAGE_kmod-mt7612u=n

# 调试工具（强烈建议保留）
CONFIG_PACKAGE_strace=y
CONFIG_PACKAGE_gdbserver=y
